# Icon Normalizer å¼€å‘æ‰‹å†Œ

## ç›®å½•
- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ–‡ä»¶ç»“æ„è¯´æ˜](#æ–‡ä»¶ç»“æ„è¯´æ˜)
- [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
- [è°ƒç”¨é“¾åˆ†æ](#è°ƒç”¨é“¾åˆ†æ)
- [ä¾èµ–å…³ç³»](#ä¾èµ–å…³ç³»)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)

## é¡¹ç›®æ¦‚è¿°

Icon Normalizer æ˜¯ä¸€ä¸ªåŸºäº AI çš„ SVG å›¾æ ‡åˆ†ç±»å’Œå»é‡å·¥å…·ï¼Œä¸“ä¸ºå‰ç«¯é¡¹ç›®ä¸­çš„å›¾æ ‡åº“ç®¡ç†è€Œè®¾è®¡ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¤– **AI æ™ºèƒ½åˆ†ç±»**: ä½¿ç”¨ OpenAI GPT-4 Vision å¯¹å›¾æ ‡è¿›è¡Œè‡ªåŠ¨åˆ†ç±»
- ğŸ” **é‡å¤æ£€æµ‹**: è¯†åˆ«å®Œå…¨ç›¸åŒå’Œç›¸ä¼¼çš„å›¾æ ‡
- ğŸ“ **å…ƒæ•°æ®åµŒå…¥**: å°†åˆ†ç±»ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ° SVG æ–‡ä»¶ä¸­
- âš¡ **æ‰¹é‡å¤„ç†**: é«˜æ•ˆå¤„ç†å¤§é‡å›¾æ ‡æ–‡ä»¶
- ğŸ›¡ï¸ **å®‰å…¨æœºåˆ¶**: è‡ªåŠ¨å¤‡ä»½å’Œé”™è¯¯å¤„ç†

### æŠ€æœ¯æ ˆ
- **è¿è¡Œæ—¶**: Node.js >= 18.0.0
- **å¼€å‘è¯­è¨€**: TypeScript
- **AI æœåŠ¡**: OpenAI GPT-4 Vision
- **CLI æ¡†æ¶**: Commander.js
- **æ–‡ä»¶å¤„ç†**: fs-extra
- **XML è§£æ**: xml2js

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLI Interface Layer                      â”‚
â”‚                 (Commander.js + Chalk)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Processing Layer                         â”‚
â”‚         (IconProcessor - ä¸šåŠ¡åè°ƒå™¨)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚  AI Engine  â”‚      â”‚   Duplicates â”‚      â”‚ File Utils  â”‚      â”‚  SVG Utils  â”‚
â”‚             â”‚      â”‚   Detector  â”‚      â”‚             â”‚      â”‚             â”‚
â”‚ â€¢ å›¾æ ‡åˆ†æ   â”‚      â”‚ â€¢ é‡å¤æ£€æµ‹   â”‚      â”‚ â€¢ æ–‡ä»¶æ“ä½œ   â”‚      â”‚ â€¢ SVGè§£æ   â”‚
â”‚ â€¢ æ‰¹é‡å¤„ç†   â”‚      â”‚ â€¢ ç›¸ä¼¼åº¦è®¡ç®—  â”‚      â”‚ â€¢ å“ˆå¸Œè®¡ç®—   â”‚      â”‚ â€¢ å…ƒæ•°æ®åµŒå…¥ â”‚
â”‚ â€¢ ç»“æœè§£æ   â”‚      â”‚ â€¢ æŠ¥å‘Šç”Ÿæˆ   â”‚      â”‚ â€¢ è·¯å¾„å¤„ç†   â”‚      â”‚ â€¢ éªŒè¯æ£€æŸ¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå›¾

```
è¾“å…¥ç›®å½• â†’ æ–‡ä»¶æ‰«æ â†’ å›¾æ ‡åŠ è½½ â†’ AIåˆ†æ â†’ é‡å¤æ£€æµ‹ â†’ ç»“æœå¤„ç† â†’ è¾“å‡ºç›®å½•
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
  SVGæ–‡ä»¶    IconInfo  å†…å®¹æ ‡å‡†åŒ–   åˆ†ç±»ç»“æœ   åˆ†ç»„ç»“æœ   å…ƒæ•°æ®åµŒå…¥  åˆ†ç±»æ–‡ä»¶å¤¹
```

## æ–‡ä»¶ç»“æ„è¯´æ˜

### æ ¸å¿ƒç±»å‹å®šä¹‰ (`src/types/index.ts`)

**åŠŸèƒ½**: å®šä¹‰é¡¹ç›®ä¸­çš„æ‰€æœ‰æ•°æ®ç±»å‹å’Œæ¥å£

**ä¸»è¦ç±»å‹**:
```typescript
// åˆ†æç»“æœ
interface AnalysisResult {
  id: string;                    // å›¾æ ‡å”¯ä¸€æ ‡è¯†
  category: string;              // åˆ†ç±»ç»“æœ
  confidence: number;            // ç½®ä¿¡åº¦
  tags: string[];               // æ ‡ç­¾åˆ—è¡¨
  duplicates: string[];         // é‡å¤é¡¹IDåˆ—è¡¨
  metadata: {                   // å…ƒæ•°æ®
    processedAt: Date;          // å¤„ç†æ—¶é—´
    version: string;            // ç‰ˆæœ¬å·
    similarity?: number;       // ç›¸ä¼¼åº¦
  };
}

// å›¾æ ‡ä¿¡æ¯
interface IconInfo {
  id: string;                   // å”¯ä¸€ID
  filename: string;            // æ–‡ä»¶å
  path: string;                // æ–‡ä»¶è·¯å¾„
  content: string;             // SVGå†…å®¹
  size: number;                // æ–‡ä»¶å¤§å°
  hash: string;                // å†…å®¹å“ˆå¸Œ
}

// é‡å¤ç»„
interface DuplicateGroup {
  master: IconInfo;            // ä¸»æ–‡ä»¶
  duplicates: IconInfo[];      // é‡å¤æ–‡ä»¶
  similarity: number;          // ç›¸ä¼¼åº¦
  recommendation: 'keep' | 'remove' | 'review'; // å»ºè®®
}
```

**ä½¿ç”¨æ–¹æ³•**:
```typescript
import { AnalysisResult, IconInfo, ProcessingOptions } from '../types';

// å®šä¹‰å¤„ç†é€‰é¡¹
const options: ProcessingOptions = {
  outputDir: './processed',
  similarityThreshold: 0.8,
  maxConcurrent: 3
};
```

### é…ç½®ç®¡ç† (`src/config/index.ts`)

**åŠŸèƒ½**: ç®¡ç†åº”ç”¨çš„é»˜è®¤é…ç½®å’Œç”¨æˆ·è‡ªå®šä¹‰é…ç½®

**ä¸»è¦é…ç½®é¡¹**:
```typescript
export const defaultConfig: Config = {
  ai: {
    model: 'gpt-4-vision-preview',  // AIæ¨¡å‹
    apiKey: process.env.OPENAI_API_KEY, // APIå¯†é’¥
    maxConcurrent: 3,                // æœ€å¤§å¹¶å‘æ•°
    timeout: 30000,                 // è¶…æ—¶æ—¶é—´
  },
  processing: {
    outputDir: './processed',       // è¾“å‡ºç›®å½•
    backup: true,                   // æ˜¯å¦å¤‡ä»½
    similarityThreshold: 0.8,      // ç›¸ä¼¼åº¦é˜ˆå€¼
  },
  categories: {                     // åˆ†ç±»æ˜ å°„
    'interface': ['navigation', 'actions', 'controls'],
    'media': ['play', 'pause', 'volume'],
    // ... æ›´å¤šåˆ†ç±»
  }
};
```

**å‡½æ•°è¯´æ˜**:
```typescript
// åŠ è½½é…ç½®ï¼Œæ”¯æŒåˆå¹¶ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
export function loadConfig(configPath?: string): Config {
  if (configPath) {
    try {
      const configData = require(configPath);
      return { ...defaultConfig, ...configData };
    } catch (error) {
      console.warn(`Failed to load config from ${configPath}:`, error);
    }
  }
  return defaultConfig;
}
```

### æ–‡ä»¶å·¥å…· (`src/utils/file-utils.ts`)

**åŠŸèƒ½**: æä¾›æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å·¥å…·å‡½æ•°

**æ ¸å¿ƒå‡½æ•°**:
```typescript
export class FileUtils {
  // æ‰«æç›®å½•ä¸­çš„SVGæ–‡ä»¶
  static async scanDirectory(dirPath: string, recursive: boolean = true): Promise<string[]>
  
  // è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼
  static async getFileHash(filePath: string): Promise<string>
  
  // è·å–æ–‡ä»¶å¤§å°
  static async getFileSize(filePath: string): Promise<number>
  
  // ç¡®ä¿ç›®å½•å­˜åœ¨
  static async ensureDir(dirPath: string): Promise<void>
  
  // å¤åˆ¶æ–‡ä»¶
  static async copyFile(src: string, dest: string): Promise<void>
  
  // å†™å…¥æ–‡ä»¶
  static async writeFile(filePath: string, content: string): Promise<void>
  
  // è¯»å–æ–‡ä»¶
  static async readFile(filePath: string): Promise<string>
  
  // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  static async fileExists(filePath: string): Promise<boolean>
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// æ‰«æç›®å½•ä¸­çš„æ‰€æœ‰SVGæ–‡ä»¶
const svgFiles = await FileUtils.scanDirectory('./icons', true);

// è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
const hash = await FileUtils.getFileHash('./icon.svg');

// å¤åˆ¶æ–‡ä»¶
await FileUtils.copyFile('./source.svg', './destination.svg');
```

### SVGå·¥å…· (`src/utils/svg-utils.ts`)

**åŠŸèƒ½**: å¤„ç†SVGæ–‡ä»¶çš„è§£æã€éªŒè¯å’Œå…ƒæ•°æ®æ“ä½œ

**æ ¸å¿ƒå‡½æ•°**:
```typescript
export class SVGUtils {
  // è§£æSVGå†…å®¹
  static async parseSVG(content: string): Promise<any>
  
  // éªŒè¯SVGæ ¼å¼
  static async validateSVG(content: string): Promise<boolean>
  
  // æå–SVGä¿¡æ¯
  static async extractSVGInfo(content: string): Promise<Partial<IconInfo>>
  
  // åµŒå…¥å…ƒæ•°æ®åˆ°SVG
  static embedMetadata(content: string, metadata: {
    category: string;
    tags: string[];
    confidence: number;
    processedAt: Date;
    version: string;
  }): string
  
  // æå–SVGä¸­çš„å…ƒæ•°æ®
  static extractMetadata(content: string): {
    category?: string;
    tags?: string[];
    confidence?: number;
    processedAt?: Date;
    version?: string;
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// åµŒå…¥å…ƒæ•°æ®
const svgWithMetadata = SVGUtils.embedMetadata(originalSvg, {
  category: 'navigation',
  tags: ['arrow', 'right'],
  confidence: 0.95,
  processedAt: new Date(),
  version: '1.0.0'
});

// æå–å…ƒæ•°æ®
const metadata = SVGUtils.extractMetadata(svgWithMetadata);
console.log(metadata.category); // 'navigation'
```

### åŠ å¯†å·¥å…· (`src/utils/crypto-utils.ts`)

**åŠŸèƒ½**: æä¾›åŠ å¯†å’Œå“ˆå¸Œç›¸å…³çš„å·¥å…·å‡½æ•°

**æ ¸å¿ƒå‡½æ•°**:
```typescript
export class CryptoUtils {
  // ç”Ÿæˆå†…å®¹ID
  static generateId(content: string): string
  
  // è®¡ç®—ç›¸ä¼¼åº¦
  static calculateSimilarity(hash1: string, hash2: string): number
  
  // ç”Ÿæˆå›¾æ ‡å”¯ä¸€ID
  static generateIconId(filename: string, content: string): string
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// ç”Ÿæˆå”¯ä¸€ID
const id = CryptoUtils.generateId(svgContent);

// è®¡ç®—ç›¸ä¼¼åº¦
const similarity = CryptoUtils.calculateSimilarity(hash1, hash2);

// ç”Ÿæˆå›¾æ ‡ID
const iconId = CryptoUtils.generateIconId('arrow.svg', svgContent);
```

### AIåˆ†æå¼•æ“ (`src/core/ai-engine.ts`)

**åŠŸèƒ½**: æ ¸å¿ƒAIåˆ†æå¼•æ“ï¼Œè´Ÿè´£ä¸OpenAI APIäº¤äº’

**æ ¸å¿ƒç±»**:
```typescript
export class AIAnalysisEngine {
  private openai: OpenAI;     // OpenAIå®¢æˆ·ç«¯
  private config: Config;      // é…ç½®ä¿¡æ¯

  constructor(config: Config) {
    this.config = config;
    this.openai = new OpenAI({
      apiKey: config.ai.apiKey,
    });
  }

  // åˆ†æå•ä¸ªå›¾æ ‡
  async analyzeIcon(iconInfo: IconInfo): Promise<AIResponse>
  
  // æ‰¹é‡åˆ†æå›¾æ ‡
  async batchAnalyze(icons: IconInfo[]): Promise<Map<string, AIResponse>>
}
```

**æ ¸å¿ƒæµç¨‹**:
1. æ„å»ºåˆ†ææç¤ºè¯
2. å°†SVGè½¬æ¢ä¸ºbase64æ ¼å¼
3. è°ƒç”¨OpenAI APIè¿›è¡Œåˆ†æ
4. è§£æè¿”å›çš„JSONç»“æœ
5. æ‰¹é‡å¤„ç†æ—¶æ§åˆ¶å¹¶å‘æ•°

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const engine = new AIAnalysisEngine(config);

// åˆ†æå•ä¸ªå›¾æ ‡
const result = await engine.analyzeIcon(iconInfo);

// æ‰¹é‡åˆ†æ
const results = await engine.batchAnalyze(icons);
```

### é‡å¤æ£€æµ‹å™¨ (`src/core/duplicate-detector.ts`)

**åŠŸèƒ½**: æ£€æµ‹å’Œå¤„ç†é‡å¤å›¾æ ‡

**æ ¸å¿ƒç±»**:
```typescript
export class DuplicateDetector {
  private options: ProcessingOptions;

  constructor(options: ProcessingOptions = {}) {
    this.options = {
      similarityThreshold: 0.8,
      ...options,
    };
  }

  // æŸ¥æ‰¾é‡å¤å›¾æ ‡
  async findDuplicates(icons: IconInfo[]): Promise<DuplicateGroup[]>
  
  // ç”Ÿæˆé‡å¤æŠ¥å‘Š
  generateReport(groups: DuplicateGroup[]): string
}
```

**æ£€æµ‹ç®—æ³•**:
1. **ç²¾ç¡®é‡å¤**: åŸºäºå†…å®¹å“ˆå¸Œå€¼å®Œå…¨åŒ¹é…
2. **ç›¸ä¼¼é‡å¤**: åŸºäºå“ˆå¸Œç›¸ä¼¼åº¦è®¡ç®—
3. **åˆ†ç»„ç­–ç•¥**: é€‰æ‹©æ–‡ä»¶åæœ€çŸ­çš„ä½œä¸ºä¸»æ–‡ä»¶
4. **å»ºè®®ç”Ÿæˆ**: æ ¹æ®ç›¸ä¼¼åº¦ç»™å‡ºå¤„ç†å»ºè®®

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const detector = new DuplicateDetector({ similarityThreshold: 0.8 });
const duplicates = await detector.findDuplicates(icons);
const report = detector.generateReport(duplicates);
```

### å›¾æ ‡å¤„ç†å™¨ (`src/processor/icon-processor.ts`)

**åŠŸèƒ½**: æ ¸å¿ƒä¸šåŠ¡åè°ƒå™¨ï¼Œç»Ÿç­¹æ‰€æœ‰å¤„ç†æ­¥éª¤

**æ ¸å¿ƒç±»**:
```typescript
export class IconProcessor {
  private options: ProcessingOptions;
  private aiEngine: AIAnalysisEngine;
  private duplicateDetector: DuplicateDetector;
  private config = defaultConfig;

  constructor(options: ProcessingOptions = {}) {
    this.options = { /* é»˜è®¤é€‰é¡¹ */ };
    this.aiEngine = new AIAnalysisEngine(this.config);
    this.duplicateDetector = new DuplicateDetector(this.options);
  }

  // å¤„ç†æ•´ä¸ªç›®å½•
  async processDirectory(inputDir: string): Promise<ProcessingResult>
}
```

**å¤„ç†æµç¨‹**:
1. æ‰«æSVGæ–‡ä»¶
2. åˆ›å»ºå¤‡ä»½ï¼ˆå¯é€‰ï¼‰
3. åŠ è½½å›¾æ ‡ä¿¡æ¯
4. æ£€æµ‹é‡å¤é¡¹
5. AIåˆ†æå”¯ä¸€å›¾æ ‡
6. å¤„ç†å¹¶ä¿å­˜ç»“æœ
7. ç”ŸæˆæŠ¥å‘Š

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const processor = new IconProcessor({
  outputDir: './processed',
  backup: true
});

const result = await processor.processDirectory('./icons');
```

### CLIæ¥å£ (`src/cli/index.ts`)

**åŠŸèƒ½**: å‘½ä»¤è¡Œæ¥å£ï¼Œæä¾›ç”¨æˆ·äº¤äº’

**ä¸»è¦å‘½ä»¤**:
```typescript
// å¤„ç†ç›®å½•
program
  .command('process')
  .description('Process a directory of SVG icons')
  .argument('<input-dir>', 'Directory containing SVG icons to process')
  .option('-o, --output <dir>', 'Output directory', './processed')
  .option('--no-backup', 'Skip creating backup')
  .option('-t, --threshold <number>', 'Similarity threshold', '0.8')
  .action(async (inputDir: string, options) => {
    // å¤„ç†é€»è¾‘
  });

// æ˜¾ç¤ºé…ç½®
program
  .command('config')
  .description('Show current configuration')
  .action(() => {
    console.log(JSON.stringify(defaultConfig, null, 2));
  });
```

## è°ƒç”¨é“¾åˆ†æ

### ä¸»è°ƒç”¨é“¾

```
CLIå…¥å£ â†’ IconProcessor.processDirectory()
    â”œâ”€â”€ 1. æ‰«ææ–‡ä»¶ (FileUtils.scanDirectory)
    â”œâ”€â”€ 2. åˆ›å»ºå¤‡ä»½ (FileUtils.copyFile)
    â”œâ”€â”€ 3. åŠ è½½å›¾æ ‡ (FileUtils.readFile + CryptoUtils.generateIconId)
    â”œâ”€â”€ 4. æ£€æµ‹é‡å¤ (DuplicateDetector.findDuplicates)
    â”‚   â”œâ”€â”€ 4.1 ç²¾ç¡®é‡å¤æ£€æµ‹ (getFileHash)
    â”‚   â””â”€â”€ 4.2 ç›¸ä¼¼é‡å¤æ£€æµ‹ (calculateSimilarity)
    â”œâ”€â”€ 5. AIåˆ†æ (AIAnalysisEngine.batchAnalyze)
    â”‚   â”œâ”€â”€ 5.1 æ„å»ºæç¤ºè¯
    â”‚   â”œâ”€â”€ 5.2 è°ƒç”¨OpenAI API
    â”‚   â””â”€â”€ 5.3 è§£æç»“æœ
    â”œâ”€â”€ 6. å¤„ç†ç»“æœ (SVGUtils.embedMetadata)
    â”œâ”€â”€ 7. ä¿å­˜æ–‡ä»¶ (FileUtils.writeFile)
    â””â”€â”€ 8. ç”ŸæˆæŠ¥å‘Š (DuplicateDetector.generateReport)
```

### AIåˆ†æè°ƒç”¨é“¾

```
AIAnalysisEngine.analyzeIcon()
    â”œâ”€â”€ 1. æ„å»ºæç¤ºè¯ (buildPrompt)
    â”œâ”€â”€ 2. è½¬æ¢SVGæ ¼å¼ (base64)
    â”œâ”€â”€ 3. è°ƒç”¨OpenAI API
    â”œâ”€â”€ 4. æ¥æ”¶å“åº”
    â””â”€â”€ 5. è§£æJSON (parseAIResponse)
```

### é‡å¤æ£€æµ‹è°ƒç”¨é“¾

```
DuplicateDetector.findDuplicates()
    â”œâ”€â”€ 1. ç²¾ç¡®é‡å¤æ£€æµ‹
    â”‚   â”œâ”€â”€ 1.1 è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
    â”‚   â”œâ”€â”€ 1.2 æŒ‰å“ˆå¸Œåˆ†ç»„
    â”‚   â””â”€â”€ 1.3 ç”Ÿæˆé‡å¤ç»„
    â””â”€â”€ 2. ç›¸ä¼¼é‡å¤æ£€æµ‹
        â”œâ”€â”€ 2.1 ä¸¤ä¸¤æ¯”è¾ƒ
        â”œâ”€â”€ 2.2 è®¡ç®—ç›¸ä¼¼åº¦
        â”œâ”€â”€ 2.3 é˜ˆå€¼è¿‡æ»¤
        â””â”€â”€ 2.4 ç”Ÿæˆåˆ†ç»„
```

## ä¾èµ–å…³ç³»

### æ¨¡å—ä¾èµ–å›¾

```
IconProcessor (ä¸»å¤„ç†å™¨)
â”œâ”€â”€ AIAnalysisEngine (AIå¼•æ“)
â”‚   â”œâ”€â”€ OpenAI (ç¬¬ä¸‰æ–¹åº“)
â”‚   â””â”€â”€ Config (é…ç½®)
â”œâ”€â”€ DuplicateDetector (é‡å¤æ£€æµ‹)
â”‚   â”œâ”€â”€ CryptoUtils (åŠ å¯†å·¥å…·)
â”‚   â””â”€â”€ ProcessingOptions (é€‰é¡¹)
â”œâ”€â”€ FileUtils (æ–‡ä»¶å·¥å…·)
â”‚   â”œâ”€â”€ fs-extra (ç¬¬ä¸‰æ–¹åº“)
â”‚   â”œâ”€â”€ path (Node.jså†…ç½®)
â”‚   â””â”€â”€ crypto (Node.jså†…ç½®)
â”œâ”€â”€ SVGUtils (SVGå·¥å…·)
â”‚   â”œâ”€â”€ xml2js (ç¬¬ä¸‰æ–¹åº“)
â”‚   â””â”€â”€ IconInfo (ç±»å‹å®šä¹‰)
â””â”€â”€ Types (ç±»å‹å®šä¹‰)
```

### å¤–éƒ¨ä¾èµ–

```
icon-normalizer
â”œâ”€â”€ openai ^4.26.0          # AI APIå®¢æˆ·ç«¯
â”œâ”€â”€ commander ^11.0.0       # CLIæ¡†æ¶
â”œâ”€â”€ chalk ^5.3.0            # ç»ˆç«¯é¢œè‰²
â”œâ”€â”€ ora ^7.0.1              # åŠ è½½åŠ¨ç”»
â”œâ”€â”€ fs-extra ^11.1.1        # æ–‡ä»¶ç³»ç»Ÿå·¥å…·
â”œâ”€â”€ xml2js ^0.6.2           # XMLè§£æ
â””â”€â”€ @types/*                # TypeScriptç±»å‹å®šä¹‰
```

### é…ç½®ä¾èµ–

```
è¿è¡Œæ—¶ä¾èµ–
â”œâ”€â”€ OPENAI_API_KEY          # ç¯å¢ƒå˜é‡
â”œâ”€â”€ Node.js >= 18.0.0       # è¿è¡Œç¯å¢ƒ
â””â”€â”€ ç½‘ç»œè¿æ¥                 # AI APIè°ƒç”¨
```

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
yarn install

# è®¾ç½®ç¯å¢ƒå˜é‡
export OPENAI_API_KEY=your_api_key_here

# å¼€å‘æ¨¡å¼
yarn run dev process ./icons

# æ„å»ºé¡¹ç›®
yarn run build

# ç±»å‹æ£€æŸ¥
yarn run type-check

# ä»£ç æ£€æŸ¥
yarn run lint
```

### æ·»åŠ æ–°çš„åˆ†ç±»

1. åœ¨ `src/config/index.ts` ä¸­æ·»åŠ æ–°åˆ†ç±»ï¼š

```typescript
categories: {
  // ç°æœ‰åˆ†ç±»...
  'new-category': ['tag1', 'tag2', 'tag3'],
}
```

2. æ›´æ–°æç¤ºè¯æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰

### æ‰©å±•AIåˆ†æèƒ½åŠ›

1. åœ¨ `AIAnalysisEngine.buildPrompt()` ä¸­ä¿®æ”¹æç¤ºè¯
2. åœ¨ `parseAIResponse()` ä¸­æ›´æ–°è§£æé€»è¾‘
3. ç›¸åº”æ›´æ–°ç±»å‹å®šä¹‰

### è‡ªå®šä¹‰é‡å¤æ£€æµ‹ç®—æ³•

1. åœ¨ `DuplicateDetector` ä¸­æ·»åŠ æ–°çš„æ£€æµ‹æ–¹æ³•
2. å®ç° `calculateContentSimilarity()` çš„æ›¿ä»£æ–¹æ¡ˆ
3. æ›´æ–°ç›¸ä¼¼åº¦é˜ˆå€¼é€»è¾‘

## æ‰©å±•å¼€å‘

### æ”¯æŒæ–°çš„æ–‡ä»¶æ ¼å¼

1. åœ¨ `FileUtils.scanDirectory()` ä¸­æ·»åŠ æ–°æ ¼å¼æ”¯æŒ
2. åˆ›å»ºå¯¹åº”çš„å·¥å…·ç±»ï¼ˆå¦‚ `PNGUtils`ã€`ICOUtils`ï¼‰
3. åœ¨ `IconProcessor` ä¸­é›†æˆæ–°æ ¼å¼å¤„ç†

### æ·»åŠ æ•°æ®åº“æ”¯æŒ

1. åˆ›å»ºæ•°æ®åº“æ¨¡å‹å’Œæ¥å£
2. å®ç° `DatabaseManager` ç±»
3. åœ¨ `IconProcessor` ä¸­æ·»åŠ æ•°æ®åº“å­˜å‚¨é€‰é¡¹

### Webç•Œé¢å¼€å‘

1. åˆ›å»ºExpress.jsæœåŠ¡å™¨
2. æ·»åŠ æ–‡ä»¶ä¸Šä¼ API
3. å®ç°WebSocketå®æ—¶è¿›åº¦æ›´æ–°
4. åˆ›å»ºå‰ç«¯React/Vueç•Œé¢

### æ€§èƒ½ä¼˜åŒ–

1. å®ç°å¤šçº¿ç¨‹å¤„ç†ï¼ˆWorker Threadsï¼‰
2. æ·»åŠ ç¼“å­˜æœºåˆ¶
3. ä¼˜åŒ–æ–‡ä»¶I/Oæ“ä½œ
4. å®ç°å¢é‡å¤„ç†

---

**æ³¨æ„**: æœ¬æ‰‹å†Œå¯¹åº” MVP ç‰ˆæœ¬ï¼Œä¸»è¦å…³æ³¨æ ¸å¿ƒåŠŸèƒ½çš„å®ç°ã€‚å¦‚éœ€æ›´å¤æ‚çš„åŠŸèƒ½æ‰©å±•ï¼Œè¯·å‚è€ƒæ¶æ„è®¾è®¡éƒ¨åˆ†è¿›è¡Œæ¨¡å—åŒ–å¼€å‘ã€‚